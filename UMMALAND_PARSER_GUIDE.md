# Руководство по использованию парсера Ummaland.com

Данный парсер предназначен для сбора информации о товарах (книгах) с сайта [umma-land.com](https://umma-land.com).

## Возможности

*   **API-First подход**: Парсинг списка товаров происходит через внутренний API сайта (`/wp-json/filters/products/`), что обеспечивает высокую скорость и надежность.
*   **Сбор детальной информации**: Парсинг страниц товаров для извлечения характеристик (Автор, Страниц, Тираж, ISBN и др.).
*   **Пагинация**: Автоматический обход всех товаров в категории.
*   **Изображения**: Сбор всех доступных изображений товара.

## Предварительная настройка

Перед использованием необходимо создать конфигурацию парсера в административной панели Django.

1.  Зайдите в админку (`/admin/scrapers/scraperconfig/`).
2.  Нажмите "Добавить Scraper config".
3.  Заполните поля:
    *   **Name**: `ummaland` (важно! имя должно совпадать с зарегистрированным именем парсера)
    *   **Base URL**: `https://umma-land.com`
    *   **Parser class**: `ummaland` (выберите из списка, если доступно, или введите вручную)
    *   **Is enabled**: ✅
    *   **Category Mapping**:
        ```json
        {
            "https://umma-land.com/product-category/books": "Книги"
        }
        ```
    *   **Run Frequency**: Выберите частоту запуска (например, `Daily`).

## Запуск парсера

### Через командную строку (CLI)

Для ручного запуска используйте команду `run_scraper`:

```bash
python3 manage.py run_scraper ummaland
```

**Дополнительные опции:**

*   `--url <URL>`: Указать конкретную категорию для парсинга (переопределяет настройки из БД).
    ```bash
    python3 manage.py run_scraper ummaland --url "https://umma-land.com/product-category/books"
    ```
*   `--max-pages <N>`: Ограничить количество страниц (хотя API возвращает все товары сразу, этот параметр может использоваться для ограничения обработки).
*   `--max-products <N>`: Ограничить количество сохраняемых товаров.
*   `--async`: Запустить задачу асинхронно через Celery.

### Через Celery (Асинхронно)

Если у вас запущен Celery worker, можно запустить парсинг в фоновом режиме:

```bash
python3 manage.py run_scraper ummaland --async
```

## Структура собираемых данных

Парсер сохраняет данные в модель `ScrapedProduct` (или создает реальные `Product` через сервис интеграции).

**Основные поля:**
*   `name`: Название книги
*   `price`: Цена (в рублях)
*   `description`: Описание
*   `images`: Список URL изображений
*   `attributes`: JSON поле с характеристиками:
    *   `author`: Автор
    *   `publisher`: Издательство
    *   `pages`: Количество страниц
    *   `isbn`: ISBN
    *   `circulation`: Тираж
    *   `cover_type`: Тип переплета
    *   `publication_year`: Год издания
    *   `age_limit`: Возрастное ограничение

## Технические детали

*   Файл парсера: `backend/apps/scrapers/parsers/ummaland.py`
*   Регистрация: `backend/apps/scrapers/parsers/registry.py`
*   Тесты: Можно использовать `test_ummaland_parser.py` (если вы его сохранили) или стандартные тесты Django.

## Устранение неполадок

*   **Товары не находятся**: Проверьте доступность API `https://umma-land.com/wp-json/filters/products/` через браузер или curl.
*   **Ошибки 403/401**: Сайт не требует авторизации для чтения, но если появится защита, может потребоваться обновление User-Agent или использование прокси.
