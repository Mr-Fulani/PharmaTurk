# Руководство по локализации категорий

## В чем была проблема

Категория "Услуги" не локализовалась, потому что:

1. **В клиентской локализации** (`localizedCategoryName`) был только статический маппинг известных категорий, и "uslugi" там не было
2. **В серверной локализации** (`getCategoryNames`) тоже не было "uslugi"
3. **В файлах локализации** не было ключей `category_uslugi_name` и `category_uslugi_description`

## Решение

Теперь система работает в два этапа:

1. **Динамический поиск** (приоритетный): пытается найти перевод по ключу `category_{slug}_name`
2. **Статический маппинг** (fallback): если динамический поиск не нашел, использует старый маппинг

Это означает, что **для большинства новых категорий достаточно добавить только ключи в файлы локализации**.

## Как добавить новую категорию

### Вариант 1: Только через файлы локализации (рекомендуется)

Если категория добавляется через админку и имеет slug (например, `new-category`):

1. **Добавьте ключи в файлы локализации:**

   `frontend/public/locales/ru/common.json`:
   ```json
   {
     "category_new-category_name": "Новая категория",
     "category_new-category_description": "Описание новой категории"
   }
   ```

   `frontend/public/locales/en/common.json`:
   ```json
   {
     "category_new-category_name": "New Category",
     "category_new-category_description": "New category description"
   }
   ```

2. **Готово!** Категория будет автоматически локализоваться:
   - В карточках категорий (главная страница, страница всех категорий)
   - В заголовке страницы категории
   - В breadcrumbs

### Вариант 2: С серверной локализацией (для SSR)

Если нужно, чтобы категория локализовалась и на сервере (при первой загрузке страницы), добавьте её в функцию `getCategoryNames`:

`frontend/src/pages/categories/[slug].tsx` (строка ~1333):

```typescript
const getCategoryNames = (locale: string = 'ru'): Record<string, { name: string; description: string }> => {
  if (locale === 'en') {
    return {
      // ... существующие категории ...
      'new-category': { name: 'New Category', description: 'New category description' }
    }
  }
  return {
    // ... существующие категории ...
    'new-category': { name: 'Новая категория', description: 'Описание новой категории' }
  }
}
```

**Примечание:** Вариант 2 нужен только если вы хотите, чтобы при первой загрузке страницы (SSR) уже было локализованное название. В большинстве случаев достаточно Варианта 1.

## Формат ключей локализации

- **Название:** `category_{normalized-slug}_name`
- **Описание:** `category_{normalized-slug}_description`

Где `normalized-slug` - это slug категории в нижнем регистре, с подчеркиваниями замененными на дефисы.

Примеры:
- Slug: `medical_equipment` → ключ: `category_medical-equipment_name`
- Slug: `new-category` → ключ: `category_new-category_name`
- Slug: `USLUGI` → ключ: `category_uslugi_name`

## Где используется локализация

1. **Карточки категорий:**
   - Главная страница (`/`)
   - Страница всех категорий (`/categories`)
   - Используется функция `getLocalizedCategoryName()` из `lib/i18n.ts`

2. **Страница категории:**
   - Заголовок страницы (`/categories/{slug}`)
   - Breadcrumbs
   - Используется `localizedCategoryName` (динамический поиск + fallback)

3. **Серверная локализация (SSR):**
   - Первая загрузка страницы
   - Используется `getCategoryNames()` в `getServerSideProps`

## Проверка

После добавления новой категории:

1. Перезапустите dev-сервер (если нужно)
2. Проверьте карточки категорий - название должно быть локализовано
3. Откройте страницу категории - заголовок должен быть локализован
4. Переключите язык - название должно меняться

## Важные замечания

- **Slug нормализуется автоматически:** подчеркивания заменяются на дефисы, все приводится к нижнему регистру
- **Fallback работает:** если перевода нет, используется название с бэкенда
- **Статический маппинг можно удалить:** в будущем можно убрать статический маппинг из `localizedCategoryName`, оставив только динамический поиск

