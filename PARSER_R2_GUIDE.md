# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–∞—Ä—Å–µ—Ä–∞–º –∏ —Ä–∞–±–æ—Ç–µ —Å R2

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–∞—Ä—Å–∏–Ω–≥–∞, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º Cloudflare R2, –Ω–∞—Å—Ç—Ä–æ–π–∫—É —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤.

---

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **–ü–∞—Ä—Å–µ—Ä—ã** –∂–∏–≤—É—Ç –≤ `backend/apps/scrapers/parsers/` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `ScrapedProduct`.
- **–ú–µ–¥–∏–∞** (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –≥–∏—Ñ) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ R2 —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π —Å–ª–æ–π: `parser_media_handler`.
- **–í –ë–î** —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ (URL) –Ω–∞ –º–µ–¥–∏–∞ –≤ R2; —Å–∞–º–∏ —Ñ–∞–π–ª—ã –ª–µ–∂–∞—Ç –≤ R2 (–∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ, –µ—Å–ª–∏ R2 –≤—ã–∫–ª—é—á–µ–Ω).
- **Credentials** (–ª–æ–≥–∏–Ω—ã/–ø–∞—Ä–æ–ª–∏ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–¥–µ–ª–∏ `ScraperConfig` –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç `.env` —Ñ–∞–π–ª–æ–≤.

---

## 2. –°–≤–æ–π—Å—Ç–≤–∞ –ø–∞—Ä—Å–µ—Ä–∞: —á—Ç–æ –æ–Ω –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å

### 2.1. –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (BaseScraper + ScrapedProduct)

–ö–∞–∂–¥—ã–π –ø–∞—Ä—Å–µ—Ä –¥–æ–ª–∂–µ–Ω:

1. **–ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç `BaseScraper`** (`backend/apps/scrapers/base/scraper.py`).
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
   - `get_name()` ‚Üí —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–∞—Ä—Å–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"instagram"`, `"ilacabak"`, `"zara"`).
   - `get_supported_domains()` ‚Üí —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–æ–≤.
   - `parse_product_list(category_url, max_pages)` ‚Üí —Å–ø–∏—Å–æ–∫ `ScrapedProduct`.
   - `parse_product_detail(product_url)` ‚Üí –æ–¥–∏–Ω `ScrapedProduct` –∏–ª–∏ `None`.
3. **–í–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ `ScrapedProduct`**:
   - `name`, `description`, `url`, `external_id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
   - `images: List[str]` ‚Äî —Å–ø–∏—Å–æ–∫ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
   - `attributes: Dict` ‚Äî –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `video_url`, `is_video`).

### 2.2. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å R2: —Ç–æ–ª—å–∫–æ URL –º–µ–¥–∏–∞

–ü–∞—Ä—Å–µ—Ä **–Ω–µ** –ø–∏—à–µ—Ç —Ñ–∞–π–ª—ã –≤ R2 —Å–∞–º. –û–Ω –æ—Ç–¥–∞—ë—Ç URL –º–µ–¥–∏–∞. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—â–∏–π —Å–µ—Ä–≤–∏—Å `download_and_optimize_parsed_media`.

---

## 3. –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–¥–∏–∞ –≤ R2

### 3.1. –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞

–ú–æ–¥—É–ª—å: `apps.catalog.utils.parser_media_handler`.

```python
from apps.catalog.utils.parser_media_handler import download_and_optimize_parsed_media

# –°–∫–∞—á–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ R2
r2_url = download_and_optimize_parsed_media(
    url=media_url,
    parser_name="instagram",
    product_id=product_data.external_id,
    index=0,
    headers=optional_headers,
)
```

### 3.2. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (–û–±–Ω–æ–≤–ª–µ–Ω–æ)

–í `apps.catalog.signals` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤, —É–∂–µ –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –≤ R2.
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–º–µ–Ω—ã:
- `r2.dev`
- `r2.cloudflarestorage.com`
- –ü—É–±–ª–∏—á–Ω—ã–π URL R2 –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (`R2_PUBLIC_URL`)

–ï—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –≤–µ–¥–µ—Ç –Ω–∞ R2, —Ñ–∞–π–ª **–Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ**, –∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ç–æ–≤–∞—Ä—É.

---

## 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä–æ–≤ (–ù–æ–≤–æ–µ)

–î–ª—è –ø–∞—Ä—Å–µ—Ä–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Instagram), —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

**–í–∞–∂–Ω–æ:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏—á–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã! Instagram –±–∞–Ω–∏—Ç –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–æ—Ç-–∞–∫–∫–∞—É–Ω—Ç—ã.

### 4.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ credentials

1. –ó–∞–π–¥–∏—Ç–µ –≤ **Admin Panel > Scrapers > Scraper Configurations**.
2. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Instagram Parser").
3. –í —Ä–∞–∑–¥–µ–ª–µ **"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" (Additional Settings)** –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - **–õ–æ–≥–∏–Ω –ø–∞—Ä—Å–µ—Ä–∞**: Username –±–æ—Ç-–∞–∫–∫–∞—É–Ω—Ç–∞.
   - **–ü–∞—Ä–æ–ª—å –ø–∞—Ä—Å–µ—Ä–∞**: –ü–∞—Ä–æ–ª—å –±–æ—Ç-–∞–∫–∫–∞—É–Ω—Ç–∞.
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### 4.2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–¥–∞—á–∞—Ö

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ **Instagram Scraper Tasks**:
1. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –ø–∞—Ä—Å–µ—Ä–∞ Instagram.
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–∑ –ë–î.
3. –ü–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –≤ —Å–∫—Ä–∏–ø—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`) –¥–ª—è –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.

---

## 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é AI (–ù–æ–≤–æ–µ)

–ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–æ–≤–∞—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ AI-–º–æ–¥—É–ª—å.
–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ AI-—Å–∏—Å—Ç–µ–º–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ:

üëâ **[AI_GUIDE.md](AI_GUIDE.md)**

–ú–æ–¥—É–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
1. **–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (Vision API) –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤.
2. **–ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é** (RAG + LLM) –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –¥–µ—Ä–µ–≤—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—é –æ–ø–∏—Å–∞–Ω–∏–π** (SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –Ω—É–∂–Ω–æ–º —è–∑—ã–∫–µ).

---

## 6. –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞

1. **–ö–ª–∞—Å—Å –ø–∞—Ä—Å–µ—Ä–∞**: –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç `BaseScraper`, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã.
2. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å –≤ `backend/apps/scrapers/parsers/registry.py`.
3. **–ú–µ–¥–∏–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `download_and_optimize_parsed_media`.
4. **–ö–æ–Ω—Ñ–∏–≥**: –°–æ–∑–¥–∞—Ç—å `ScraperConfig` –≤ –∞–¥–º–∏–Ω–∫–µ.

---

## 7. –í–∞–∂–Ω—ã–µ –º–æ–¥—É–ª–∏

| –ó–∞–¥–∞—á–∞ | –ú–æ–¥—É–ª—å / –ø—É—Ç—å |
|--------|----------------|
| –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å | `backend/apps/scrapers/base/scraper.py` |
| –ó–∞–≥—Ä—É–∑–∫–∞ –≤ R2 | `backend/apps/catalog/utils/parser_media_handler.py` |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ R2 | `backend/apps/catalog/utils/storage_paths.py` |
| –°–∏–≥–Ω–∞–ª—ã (–∞–Ω—Ç–∏-–¥—É–±–ª—å) | `backend/apps/catalog/signals.py` |
| –ú–æ–¥–µ–ª–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤ | `backend/apps/scrapers/models.py` |
| –ê–¥–º–∏–Ω–∫–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤ | `backend/apps/scrapers/admin.py` |
| AI –õ–æ–≥–∏–∫–∞ | `backend/apps/ai/` |
